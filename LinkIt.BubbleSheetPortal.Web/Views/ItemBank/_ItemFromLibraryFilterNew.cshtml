<script src="@Url.Content("~/Scripts/TagIt/js/tag-it.js")" type="text/javascript"></script>
<link href="@Url.Content("~/Scripts/TagIt/css/jquery.tagit.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Scripts/TagIt/css/tagit.ui-zendesk.css")" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="@Url.Content("~/Scripts/knockout-3.0.0.js")"></script>
<style>
    .coolfieldset .qtiItemSelector .filter-item-criteria .manage-class-legend {
        padding-left: 1em;
        font-weight: 700;
        margin-left: 11px;
        position: relative;
        top: 10px;
        z-index: 111;
    }

    .coolfieldset .qtiItemSelector {
        border: none;
        background: transparent;
        padding: 0;
    }

    .manage-class-legend:not(.arrow-expand) {
        background: #e7e7e7 url(/Content/themes/base/images/collapsed.gif) no-repeat center left;
        background-size: 10px 10px;
    }

    .manage-class-legend.arrow-expand {
        background: #e7e7e7 url(/Content/themes/base/images/expanded.gif) no-repeat center left;
        background-size: 10px 10px;
    }

    .district-tag-category legend:not(.arrow-expand) {
        background: #e7e7e7 url(/Content/themes/base/images/collapsed.gif) no-repeat center left;
        background-size: 10px 10px;
    }

    #fsItemCriteria legend {
        background-color: #e7e7e7 !important;
    }

        #fsItemCriteria legend:not(.arrow-expand) {
            background: #e7e7e7 url(/Content/themes/base/images/collapsed.gif) no-repeat center left;
            background-size: 10px 10px;
        }

        #fsItemCriteria legend.arrow-expand {
            background: #e7e7e7 url(/Content/themes/base/images/expanded.gif) no-repeat center left;
            background-size: 10px 10px;
        }
</style>
<div id="tab-item-criteria-new" class="itemLibraryTab-pane" style="display: block">
    <fieldset class="grey-bg coolfieldset qtiItemSelector">
        <div id="divStandardContainerNew">
            @*@Html.Partial("_StandardFilter")*@
        </div>
        <div id="div-district-tag-category">
            <fieldset class="grey-bg district-tag-category">
                <legend class="u-cursor-pointer">@LabelHelper.DistrictLabel Tag Category</legend>

                <div class="columns expand-content content">
                    <div class="colx2-left linkit-tab">
                        <p>
                            <label>@LabelHelper.DistrictLabel Tag Category</label>
                            <input id="txtDistrictTag" style="width: 300px; display: none" />
                            <select id="selectDistrictCategory" data-bind='options: DistrictCategories, optionsText: "Text", optionsValue: "Value", optionsCaption: "All", value: DistrictCategoryId' style="width: 300px"></select>
                        </p>
                        <p>
                            <label>@LabelHelper.DistrictLabel Tag </label>
                            <div class="wraptag" style="max-width: 300px">
                                <ul id="singleFieldTags"></ul>
                            </div>
                        </p>
                    </div>
                    <div class="colx2-right linkit-tab">
                        <p>
                            <label>Topics <img src="/Content/themes/Constellation/images/icons/fugue/information-blue.png" title=">
                        <p align='left'>Use AND/OR in all caps to connect search terms to find <br /> test items that include both or either connected search terms.</p>" class="with-tip" style="width:12px" /></label>
                        <input id="txtTopic" style="width: 300px;" />
                        </p>
                        <p>
                            <label>Skills <img src="/Content/themes/Constellation/images/icons/fugue/information-blue.png" title=">
                        <p align='left'>Use AND/OR in all caps to connect search terms to find <br /> test items that include both or either connected search terms.</p>" class="with-tip" style="width:12px" /></label>
                        <input id="txtSkill" style="width: 300px;" />
                        </p>
                        <p>
                            <label>Other <img src="/Content/themes/Constellation/images/icons/fugue/information-blue.png" title=">
                        <p align='left'>Use AND/OR in all caps to connect search terms to find <br /> test items that include both or either connected search terms.</p>" class="with-tip" style="width:12px" /></label>
                        <input id="txtOther" style="width: 300px;" />
                        </p>
                    </div>
                </div>
            </fieldset>
        </div>
    </fieldset>

    <fieldset class="grey-bg coolfieldset qtiItemSelector">
        <div id="divStandardContainer">
            @*@Html.Partial("_StandardFilter")*@
        </div>
    </fieldset>

    <fieldset class="grey-bg coolfieldset qtiItemSelector">
        <legend class="u-cursor-pointer manage-class-legend filter-item-criteria">Item Criteria</legend>
        <div class="columns expand-content" id="divItemCriteriaNew">
            <div class="colx2-left">
                <br>
                <p>
                    <label>Item Banks</label>
                    <select id="selectItemsBankId" data-bind='options: ItemBanks, optionsText: "Text", optionsValue: "Value", optionsCaption: "All", value: ItemBankId' style="width: 300px"></select>
                </p>
                <p>
                    <label>Item Set</label>
                    <select id="selectItemsSetId" data-bind='options: ItemSets, optionsText: "Text", optionsValue: "Value", optionsCaption: "All", value: ItemSetId' style="width: 305px !important"></select>
                </p>

                <p>
                    <label id="selectItemTypeLabel">Item Type</label>
                    <select id="selectItemType">
                        <option value="-1" titlespecial="All">All</option>
                    </select>
                </p>
                <p>
                    <label>Keyword(s)</label>
                    <input id="txtKeyword" style="width: 300px;" />
                </p>
            </div>
        </div>
    </fieldset>
    <fieldset class="grey-bg coolfieldset qtiItemSelector" id="fsItemCriteria">
        <legend class="u-cursor-pointer">Item Criteria</legend>
        <div class="columns expand-content" id="divItemCriteria" style="display: none;">
            <div class="colx2-left">
                <br>
                <p>
                    <label id="selectQTI3pSubjectIdLabel">Subject</label>
                    <select id="selectQTI3pSubjectId">
                        <option value="">All</option>
                    </select>
                </p>

                <p>
                    <label id="selectGradeIdLabel">@LabelHelper.GradeLabel</label>
                    <select id="selectGradeId">
                        <option value="">All</option>
                    </select>
                </p>

                <p>
                    <label id="selectItemTypeLabel">Item Type</label>
                    <select id="selectItemType">
                        <option value="-1" titlespecial="All">All</option>
                    </select>
                </p>
                <p>
                    <label>
                        Keyword(s) <img src="/Content/themes/Constellation/images/icons/fugue/information-blue.png" title="
                <p align='left'>Use AND/OR in all caps to connect search terms to find <br /> test items that include both or either connected search terms.</p>" class="with-tip" style="width:12px" />
                </label>

                <input id="idKeyword" style="width: 300px;" />
                </p>
            </div>
            <div class="colx2-right">
                <br>
                <p>
                    <label>Webb's Depth of Knowledge (DOK)</label>
                    <select id="selectQTI3pDOKId">
                        <option value="">All</option>
                    </select>
                </p>
                <p>
                    <label id="selectDifficultyIdLabel">Difficulty</label>
                    <select id="selectDifficultyId">
                        <option value="">All</option>
                    </select>
                </p>
                <p>
                    <label id="selectBloomsIdLabel">Bloom's Taxonomy</label>
                    <select id="selectBloomsId">
                        <option value="">All</option>
                    </select>
                </p>
                <p>
                    <label id="selectQTI3pCerticaItemLanguageLabel">Language</label>
                    <select id="selectQTI3pCerticaItemLanguage">
                        <option value="">All</option>
                    </select>
                </p>
            </div>
        </div>
    </fieldset>
    <div class="clear"></div>
    <div class="float-right">
        <button id="setFilter" type="submit">Search by Item</button>
        <button id="setFilterNWEA" type="submit" style="display: none">Search by Item</button>
        <button id="showPassagesForFoundItem" type="submit" disabled>Show Passages for Found Items</button>
        <button id="clearFilterItem" style="margin-right: 5px" type="button">Clear Item Filters</button>
    </div>
    <div class="clear"></div>
</div>

<script type="text/javascript">
    var tagDict = {};
    var selectedTagsDict = {};
    var avaiableTags = ['c++', 'java', 'php', 'coldfusion', 'javascript', 'asp', 'ruby', 'python', 'c', 'cc', 'ccc', 'cccc', 'cccccc', 'ccccccc', 'cccccccccc', 'cccccccccc', 'cccccccccccc', 'ccccccccccccc', 'cccccccccccccccc', 'ccccccccccccccccccc', 'ccccccccccccccccccc', 'cccccccccccccccccccccc', 'ccccccccccccccccccccccc', 'ca', 'cb', 'cf', 'cd', 'ce', 'cr', 'cg', 'ch', 'cj', 'ck', 'scala', 'groovy', 'haskell', 'perl', 'erlang', 'apl', 'cobol', 'go', 'lua'];
    $(function () {
        $('.with-tip').tip();
    });

    $('#selectDistrictCategory').die('change');
    $("#selectDistrictCategory").change(function () {
        var categoryId = $("#selectDistrictCategory").val();
        if (categoryId == null || categoryId == 'select' || categoryId < 0) {
            categoryId = 0;
        }
        var categoryName = $("#selectDistrictCategory option:selected").text();
        if (categoryName == null) {
            categoryName = '';
        }

        // Do not need to query data when category is not selected
        if (categoryId == '') {
            $('#singleFieldTags').tagit({
                availableTags: avaiableTags,
                // This will make Tag-it submit a single form value, as a comma-delimited field.
                singleField: true,
                autocomplete: ({ appendTo: ".wraptag", minLength: 0 }),
                beforeTagAdded: function (event, ui) {

                    //the last element
                    var customTag = categoryName + ':' + ui.tagLabel;
                    var tagId = tagDict[ui.tagLabel];
                    if (tagId != undefined) {
                        selectedTagsDict[customTag] = tagId;//remember Id of selected tag
                    }
                    $(ui.tag).find(".tagit-label").last().html(customTag);
                },
                beforeTagRemoved: function (event, ui) {

                    var removedTag = ui.tagLabel.split(':')[1];
                    var selectedTags = $('.wraptag [name="tags"]').attr('value');
                    selectedTags = selectedTags.replace(removedTag, '');
                    $('.wraptag [name="tags"]').attr('value', selectedTags);
                    //clear the selected tag out of memory
                    delete selectedTagsDict[ui.tagLabel];
                }
            });
            return;
        }

        var url = '@Url.Action("GetDistrictTags", "ItemTag")/?districtCategoryId=' + categoryId;
        $.ajax({
            url: url,
            type: 'get',
            cache: false,
            //data: { stateId: self.StateId() }
        }).done(function (data) {
            data = data.reverse();
            avaiableTags.length = 0;//clear
            //get
            tagDict = {};//clear dictionary
            while (data.length > 0) {
                var object = data.pop();
                //avaiableTags.push(categoryName +':' + object.Name);
                avaiableTags.push(object.Name);
                tagDict[object.Name] = object.Id;
            }

            $('#singleFieldTags').tagit({
                availableTags: avaiableTags,
                // This will make Tag-it submit a single form value, as a comma-delimited field.
                singleField: true,
                autocomplete: ({ appendTo: ".wraptag", minLength: 0 }),
                beforeTagAdded: function (event, ui) {

                    //the last element
                    var customTag = categoryName + ':' + ui.tagLabel;
                    var tagId = tagDict[ui.tagLabel];
                    if (tagId != undefined) {
                        selectedTagsDict[customTag] = tagId;//remember Id of selected tag
                    }
                    $(ui.tag).find(".tagit-label").last().html(customTag);
                },
                beforeTagRemoved: function (event, ui) {

                    var removedTag = ui.tagLabel.split(':')[1];
                    var selectedTags = $('.wraptag [name="tags"]').attr('value');
                    selectedTags = selectedTags.replace(removedTag, '');
                    $('.wraptag [name="tags"]').attr('value', selectedTags);
                    //clear the selected tag out of memory
                    delete selectedTagsDict[ui.tagLabel];
                }
            });

        });
    });

    function getSelectedTags() {
        //var x = '';
        //$('#singleFieldTags').find('li.tagit-choice').each(function(idx, li) {
        //    var span = $(li).find('span').first();
        //    //alert(span.html());
        //    //x += encodeURIComponent(span.text()) + ';';
        //    x += encodeURIComponent(span.text()) + ',|,';
        //});
        //return x;
        var x = '';
        for (var key in selectedTagsDict) {
            x += selectedTagsDict[key] + ',';
        }
        return x;
    }
    function getSelectedTagName() {
        var x = '';
        $('#singleFieldTags').find('li.tagit-choice').each(function (idx, li) {
            var span = $(li).find('span').first();
            //alert(span.html());
            //x += encodeURIComponent(span.text()) + ',';
            x += span.text() + ', ';
        });
        x = x.trim();
        //remove the last ','
        x = x.substring(0, x.length - 1);
        return x;
    }
</script>
<!-- If Tag dropdown is open, click outside of this control will close the tag dropdown -->
<script type="text/javascript">
    $('body').click(function () {
        var ul = $('.wraptag').find('ul.ui-autocomplete').first();
        var display = ul.css('display');
        if (display != 'none') {
            ul.hide();
        }
    });
    $('#singleFieldTags').click(function (event) {
        if (event.stopPropagation) {
            event.stopPropagation();
        }
        else if (window.event) {
            window.event.cancelBubble = true;
        }
    });
    $('.tagit-dropdown').click(function (event) {

        if (event.stopPropagation) {
            event.stopPropagation();
        }
        else if (window.event) {
            window.event.cancelBubble = true;
        }
    });

    function CollapsibleFilter() {
        $content = $('#divItemCriteriaNew');
        $content.toggleClass('expand-content');
        $content.toggle();
        $(".manage-class-legend").toggleClass('arrow-expand');
    }
</script>
<script type="text/javascript">
    $(document).ready(function () {

        $("#clearFilterItem").click(function () {
            $('#idKeyword').val('');
            $('#txtKeyword').val('');
            $("#tab-item-criteria-new select").prop('selectedIndex', 0);
            $('#dvStandardTreeView').html('<span>Please use the filters to search</span>');
            $('#txtTopic').val('');
            $('#txtSkill').val('');
            $('#txtOther').val('');
            $('#txtDistrictTag').val('');
        });
    });

    $(".manage-class-legend").click(function (e) {
        if ($(e.target).attr('disabled') === 'disabled') {
            return;
        }
        CollapsibleFilter();
    });
</script>
<script>
    function CollapsibleDistrictTagCategory() {
        $content = $('.district-tag-category .content');
        $content.toggleClass('expand-content');
        $content.toggle();
        $(".district-tag-category > legend").toggleClass('arrow-expand');
    }

    $(".district-tag-category > legend").click(function (e) {
        if ($(e.target).attr('disabled') === 'disabled') {
            return;
        }
        CollapsibleDistrictTagCategory();
    });

    CollapsibleDistrictTagCategory();
    function CollapsibleFSItemCriteria() {
        $('#fsItemCriteria #divItemCriteria').toggleClass('expand-content');
        $('#fsItemCriteria #divItemCriteria').toggle();
        $("#fsItemCriteria > legend").toggleClass('arrow-expand');
    }
    $(document).ready(function () {
        $('#fsItemCriteria > legend').off('click');
        $('#fsItemCriteria > legend').unbind('click');
        $('#fsItemCriteria > legend').click(function (e) {
            if ($(e.target).attr('disabled') === 'disabled') {
                return;
            }
            CollapsibleFSItemCriteria();
        });
    });
</script>
