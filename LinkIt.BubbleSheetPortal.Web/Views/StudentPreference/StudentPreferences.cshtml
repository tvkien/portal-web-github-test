@using LinkIt.BubbleSheetPortal.Web.Helpers
@using LinkIt.BubbleSheetPortal.Models.Constants
@using LinkIt.BubbleSheetPortal.Web

@model int
@{
    ViewBag.Title = "Set Student/Parent Portal Options";
}
<style>
    .pIcon {
        position: relative;
        left: 11px;
    }

    .blockUI {
        z-index: 1013 !important;
    }

    #student-references {
        max-width: 940px;
        min-height: 1000px;
        margin: 30px auto 0;
    }

        #student-references .block-border {
            width: 918px;
        }

    .block-border .filter-group {
        background: #fff;
        padding: 2.833em 1.667em 1.667em;
    }

        .block-border .filter-group .fileter-item {
            width: 44%;
            float: left;
            margin-bottom: 1.667em;
            margin-left: 4%;
        }

        .block-border .background-filter::after,
        .block-border .filter-group::after,
        #student-references .block-border::after,
        #student-references::after,
        .block-border .filter-group .btn-filter::after {
            display: table;
            clear: both;
            content: '';
        }

    .block-checkbox {
        height: 150px;
        overflow: auto;
        background: #fff;
        border-top: 1px solid #a2a2a2;
    }

    .fileter-checkbox {
        width: 220px;
        margin-bottom: 1.667em;
        margin-left: 4%;
        float: left;
        border: 1px solid #a2a2a2;
        padding-top: 10px;
        position: relative;
    }

    .filter-test-types.fileter-checkbox {
        width: 220px;
    }

    .checkbox-subject {
        width: 220px;
    }

    .checkbox-visible .block-checkbox {
        height: 50px;
    }

    .checkbox-container .fileter-checkbox > .chechbox {
        margin-bottom: 10px;
        margin-left: 10px;
    }

    .block-border .checkbox-container .fileter-item {
        float: none;
    }

    .checkbox-container .checkbox-child {
        padding: 0px 0 0 9px;
    }

        .checkbox-container .checkbox-child .chechbox {
            display: inline-block;
        }

        .checkbox-container .checkbox-child input[type=checkbox] + label {
            width: calc(100% - 18px);
            display: inline-block;
            padding: 9px 0px 7px;
        }

        .checkbox-container .checkbox-child:nth-last-child(even) {
            background: #f1f1f1
        }

    .btn-filter,
    .btn-clear-filter {
        float: right;
        margin-left: 10px;
    }

        .btn-clear-filter:disabled,
        .grey.btn-clear-filter:hover {
            color: #bfbfbf;
            border-color: #e9f2f6 #c4c3c3 #a2a2a2 #e3e2e2;
            background: #c8c8c8 url(../images/old-browsers-bg/button-element-disabled-bg.png) repeat-x top;
            background: -moz-linear-gradient( top, #f0f2f2, #c8c8c8);
            background: -webkit-gradient(linear, left top, left bottom, from(#f0f2f2), to(#c8c8c8));
            -moz-text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.75);
            -webkit-text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.75);
            text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.75);
        }

    .loading::before {
        content: '';
        position: absolute;
        top: -4px;
        left: -3px;
        bottom: 2px;
        right: 3px;
        background: rgba(255, 255, 255, 0.5);
        z-index: 3;
        border-radius: 19px;
    }

    .loading::after {
        content: '';
        position: absolute;
        border: 16px solid #f3f3f3;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #3498db;
        border-radius: 50%;
        width: 15px;
        height: 15px;
        left: 17px;
        top: 0;
        z-index: 4;
        animation: spin 2s linear infinite;
    }

    @@-webkit-keyframes spin {
        0% {
            -webkit-transform: rotate(0deg);
        }

        100% {
            -webkit-transform: rotate(360deg);
        }
    }

    @@keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    .button-switch {
        font-size: 14px;
        height: 1.875em;
        position: relative;
        width: 4.5em;
    }

        .button-switch .lbl-off,
        .button-switch .lbl-on {
            cursor: pointer;
            display: block;
            font-size: 0.9em;
            font-weight: bold;
            line-height: 1em;
            position: absolute;
            top: 5px;
            transition: opacity 0.25s ease-out 0.1s;
            text-transform: uppercase;
        }

        .button-switch .lbl-off {
            right: 0.4375em;
        }

        .button-switch .lbl-on {
            color: #fefefe;
            opacity: 0;
            left: 0.4375em;
        }

        .button-switch .switch-input {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            height: 0;
            font-size: 1em;
            left: 0;
            line-height: 0;
            outline: none;
            position: absolute;
            top: 0;
            width: 0;
        }

            .button-switch .switch-input:before,
            .button-switch .switch-input:after {
                content: '';
                font-size: 1em;
                position: absolute;
            }

            .button-switch .switch-input:before {
                border-radius: 1.25em;
                background: #bdc3c7;
                height: 1.875em;
                left: -0.25em;
                top: -0.1875em;
                transition: background-color 0.25s ease-out 0.1s;
                width: 4.5em;
            }

            .button-switch .switch-input:after {
                box-shadow: 0 0.0625em 0.375em 0 #666;
                border-radius: 50%;
                background: #fefefe;
                height: 1.5em;
                transform: translate(0, 0);
                transition: transform 0.25s ease-out 0.1s;
                width: 1.5em;
            }

            .button-switch .switch-input:checked:after {
                transform: translate(2.5em, 0);
            }

            .button-switch .switch-input:checked ~ .lbl-off {
                opacity: 0;
            }

            .button-switch .switch-input:checked ~ .lbl-on {
                opacity: 1;
            }

            .button-switch .switch-input:checked:before {
                background: #3498db;
            }

    .dialog-custom {
        background: transparent;
        padding: 0;
        margin: 0;
        border: none;
    }

        .dialog-custom .ui-dialog-title {
            padding: 0;
            margin: 0;
        }

        .dialog-custom .ui-dialog-titlebar {
            padding: 0;
            z-index: 1004;
        }

        .dialog-custom .ui-dialog-titlebar-close {
            height: 35px;
            width: 35px;
            background: #fff;
            border-radius: 50%;
            top: -10px;
            overflow: hidden;
            padding: 0;
        }

            .dialog-custom .ui-dialog-titlebar-close:hover {
                border: none;
                padding: 0;
            }

        .dialog-custom .ui-dialog-titlebar .ui-icon-closethick {
            background-image: url("/Content/themes/base/images/fancy_close.png");
            width: 100%;
            background-position: -1px -1px;
            background-repeat: no-repeat;
            background-size: cover;
            height: 100%;
        }

    .alert-custom {
        background: transparent;
        border: transparent;
    }

    #changeRefBtn:not(.btn-disabled) {
        color: white;
        border-color: #50a3c8 #297cb4 #083f6f;
        background: #0c5fa5 url(../images/old-browsers-bg/title-bg.png) repeat-x top;
        -webkit-background-size: 100% 100%;
        -moz-background-size: 100% 100%;
        -o-background-size: 100% 100%;
        background-size: 100% 100%;
        background: -moz-linear-gradient(top, white, #72c6e4 4%, #0c5fa5);
        background: -webkit-gradient( linear, left top, left bottom, from(white), to(#0c5fa5), color-stop(0.03, #72c6e4));
    }

    .btn-disabled {
        pointer-events: none;
        color: #cccccc;
        border: 1px solid;
        border-color: #7e9098 #61727b #2b373d;
        background: #40535c url(../images/old-browsers-bg/title-link-bg.png) repeat-x top;
        -webkit-background-size: 100% 100%;
        -moz-background-size: 100% 100%;
        -o-background-size: 100% 100%;
        background-size: 100% 100%;
        background: -moz-linear-gradient(top, white, #9eb1ba 4%, #40535c);
        background: -webkit-gradient(linear, left top, left bottom, from(white), to(#40535c), color-stop(0.03, #9eb1ba));
    }

    .jsViewPreference {
        position: relative;
        top: -2px;
    }

    .button-switch .switch-input:disabled {
        pointer-events: none;
    }

        .button-switch .switch-input:disabled:before,
        .button-switch .switch-input:checked:disabled:before {
            background: #989898;
        }

        .button-switch .switch-input:disabled::after {
            background: #4c4c4c;
        }

    .container_12 .block-border .header-preference-page {
        font-size: 0.778em;
        line-height: 18px;
        margin: 0;
    }

    #student-references .block-border .tabs .tab-view {
        float: left;
        background: #eee;
        cursor: pointer;
        border-radius: 6px 6px 0px 0px;
    }

        #student-references .block-border .tabs .tab-view a {
            padding: 10px 20px;
            display: block;
            font-size: 10pt;
        }

    #student-references .block-border .tabs ul {
        border-bottom: 2px solid #d5d8db;
    }

        #student-references .block-border .tabs ul::after {
            content: '';
            clear: both;
            float: none;
            display: block;
        }

    #student-references .block-border .tabs .tab-view.is-active {
        background: #4d93c5;
        border-bottom: none;
        background: -webkit-gradient( linear, left top, left bottom, from(white), to(#0c5fa5), color-stop(0.03, #72c6e4) );
    }

        #student-references .block-border .tabs .tab-view.is-active a {
            color: #fff;
        }

    #student-references .block-border .tabs {
        margin: 16px 0;
    }

    .option-view {
        margin-top: 30px;
    }

        .option-view .lable-option {
            font-size: 15px;
            display: inline;
            line-height: 1.333em;
            border: 1px solid;
            border-color: #50a3c8 #297cb4;
            color: #fff;
            background: #0c5fa5 url(../images/old-browsers-bg/title-bg.png) repeat-x top;
            -webkit-background-size: 100% 100%;
            -moz-background-size: 100% 100%;
            -o-background-size: 100% 100%;
            background-size: 100% 100%;
            background: -moz-linear-gradient(top,white,#72c6e4 4%, #0c5fa5);
            background: -webkit-gradient(linear,left top, left bottom,from(white),to(#0c5fa5),color-stop(0.03, #72c6e4));
            -moz-text-shadow: -1px -1px 0 rgba(0, 0, 0, 0.2);
            -webkit-text-shadow: -1px -1px 0 rgba(0, 0, 0, 0.2);
            text-shadow: -1px -1px 0 rgba(0, 0, 0, 0.2);
            padding: 9px 15px;
            position: relative;
            top: -51px;
            left: -32px;
            border: 1px solid white;
            -webkit-box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
            -webkit-border-radius: 0.417em;
            -webkit-background-clip: padding-box;
            border-radius: 0.417em;
        }

    .accordion-header, .group-bs .group-header {
        font-size: 13px;
        font-weight: 700;
        display: block;
        padding: 11px;
        background: #efefef;
        border: 2px solid #fff;
        border-radius: 5px;
        border-bottom-right-radius: 0;
        border-bottom-left-radius: 0;
        box-shadow: 2px 0px 6px #8d8d94;
        cursor: pointer;
        color: #737373;
    }

    .group-bs .accordion-header {
        color: #3399cc;
    }

    .group-bs .accordion-container:first-of-type {
        margin-top: 10px;
    }

    .accordion-container .accordion-content,
    .modal .content-option {
        display: table;
        width: 100%;
        width: calc(100% - 24px);
        padding: 9px 0 9px 24px;
    }

        .accordion-container .accordion-content .lable,
        .modal .content-option .lable {
            display: table-cell;
            width: 50%;
        }

        .accordion-container .accordion-content .sub-title,
        .modal .content-option .sub-title {
            text-transform: capitalize;
        }

    .accordion-container, .group-bs {
        margin-bottom: 5px;
        margin-left: 2%;
        margin-right: 2%;
        border-radius: 5px;
        box-shadow: 0px 0px 5px #9e9e9e;
        overflow: hidden;
        margin-top: 1%;
    }

        .group-bs .accordion-container {
            margin-left: 15px;
            margin-right: 2%;
        }

    .option-container {
        background: #e6e6e6;
        padding: 38px 0px 38px 24px;
        border-radius: 5px;
        position: relative;
    }

        .option-container .bg-gray, .modal .bg-gray {
            background: #f2f2f2;
        }

    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: table;
        transition: opacity 0.3s ease;
        z-index: 1111;
    }

    .modal-wrapper {
        display: table-cell;
        vertical-align: middle;
    }

    .modal-container {
        background: #fff;
        display: table;
        border-radius: 5px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, .33);
        transition: all 0.3s ease;
        margin: 0 auto;
        overflow: hidden;
        border-radius: 5px;
        position: relative;
    }

    .modal-enter, .modal-leave {
        opacity: 0;
    }

        .modal-enter .modal-container, .modal-leave .modal-container {
            -webkit-transform: scale(1.1);
            transform: scale(1.1);
        }

    .modal-container .modal-body {
        max-height: calc(100vh - 120px);
        overflow-y: auto;
        padding: 0px 30px;
    }

    .modal .modal-body {
        margin-top: 20px;
    }

    .modal-header h2 {
        padding: 10px 30px;
        background: #e6e6e6;
    }

    .modal-body .accordion-container, .modal-body .group-bs {
        margin-left: 2%;
        margin-right: 2%;
    }

        .modal-body .group-bs .accordion-container {
            margin: 15px;
        }

    .option-container .btn-change-option {
        display: block;
        right: 5%;
        position: absolute;
        bottom: 10px;
    }

    .modal .modal-footer {
        position: relative;
        height: 50px;
        text-align: right;
        padding: 0px 30px;
    }

    .pointer {
        cursor: pointer;
    }

    .btn-view-matrix {
        display: inline-block;
        top: 3px;
    }

        .btn-view-matrix > span {
            font-size: 10px !important;
            background: #00a2e9 !important;
        }

    .no-data {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

    #changeOptionTest {
        left: 230px;
    }

        #changeOptionTest:not(.btn-disabled), .btn-change-option:not(.btn-disabled) {
            color: white;
            border-color: #50a3c8 #297cb4 #083f6f;
            background: #0c5fa5 url(../images/old-browsers-bg/title-bg.png) repeat-x top;
            -webkit-background-size: 100% 100%;
            -moz-background-size: 100% 100%;
            -o-background-size: 100% 100%;
            background-size: 100% 100%;
            background: -moz-linear-gradient(top, white, #72c6e4 4%, #0c5fa5);
            background: -webkit-gradient( linear, left top, left bottom, from(white), to(#0c5fa5), color-stop(0.03, #72c6e4));
        }

    .bg-full {
        position: absolute;
        left: 0;
        bottom: 0;
        right: 0;
        top: 0;
        background: rgba(76, 76, 76, 0.8);
        z-index: 100;
    }

    .loading-dot {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        z-index: 101;
        color: #fff;
        font-size: 20px;
    }

        .loading-dot:after {
            content: ' .';
            animation: dots 1s steps(5, end) infinite;
        }

    @@keyframes dots {
        0%, 20% {
            color: rgba(0,0,0,0);
            text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0);
        }

        40% {
            color: white;
            text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0);
        }

        60% {
            text-shadow: .25em 0 0 white, .5em 0 0 rgba(0,0,0,0);
        }

        80%, 100% {
            text-shadow: .25em 0 0 white, .5em 0 0 white;
        }
    }

    .open-icon {
        border: 1px solid #888888;
        border-radius: 50%;
        height: 14px;
        width: 14px;
        position: relative;
    }

        .open-icon > span {
            background: #397c33;
            color: white;
            font-weight: 700;
            border-radius: 50%;
            position: absolute;
            top: -4px;
            left: 1px;
            bottom: 1px;
            top: 1px;
            right: 1px;
        }

            .open-icon > span > span {
                position: absolute;
                top: -2px;
                left: 1.5px;
            }

    .matrix .modal-header {
        padding: 10px;
        background: #e6e6e6;
        height: 32px;
    }

        .matrix .modal-header h2 {
            float: left;
        }

        .matrix .modal-header img {
            float: right;
            margin-top: 10px;
            margin-right: 5px;
        }

    .matrix .modal-body {
        overflow: auto;
        clear: both;
        position: static !important;
        min-width: 730px;
    }

    .p-line {
        margin-left: 42px;
    }

    .btn-under-grid {
        height: 36px;
        padding: 8px;
        margin-left: 10px;
        border-radius: 4px;
        text-transform: uppercase;
    }

    #dataTable td {
        word-break: break-word;
    }

    .modal .modal-container {
        min-height: 240px;
    }

    .mgt-40 {
        margin-top: 40px;
        font-weight: 500;
    }

    #notificationTimeout .modal-timeout {
        position: fixed;
        z-index: 9998;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, .5);
        display: table;
        transition: opacity .3s ease;
    }

    #notificationTimeout .body-modal {
        background: url(../images/old-browsers-bg/white20.png);
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid #fff;
        border-color: rgba(255, 255, 255, 0.75);
        border-radius: 0.8em;
        box-shadow: 0 0 4px rgba(50, 50, 50, 0.5);
        width: 420px;
        margin: 0 auto;
        padding: 0.833em;
        position: absolute;
        left: 50%;
        top: 50%;
        -webkit-transform: translate(-50%, -50%);
        ;
        -moz-transform: translate(-50%, -50%);
        ;
        -ms-transform: translate(-50%, -50%);
        ;
        -o-transform: translate(-50%, -50%);
        ;
        transform: translate(-50%, -50%);
    }

        #notificationTimeout .body-modal .modal--content {
            background-color: #fff;
            padding: 25px 15px;
        }

    .border-right {
        border-right: 1px solid #3399cc;
    }

    ul#selectClasses li:first-child {
        font-weight: bold;
    }

    ul#selectClasses .tagit-new {
        max-width: 169px;
    }

    ul.tagit li:not(:first-child) ::-webkit-input-placeholder {
        opacity: 0;
    }

    ul.tagit li:not(:first-child) ::-moz-placeholder {
        opacity: 0;
    }

    ul.tagit li:not(:first-child) ::-ms-input-placeholder {
        opacity: 0;
    }

    ul.tagit li:not(:first-child) ::placeholder {
        opacity: 0;
    }

    .tagit-dropdown {
        position: static !important
    }

    .ui-autocomplete {
        width: 365px !important;
        top: 527px;
        margin-left: calc((100vw - 940px)/2 + 78px) !important;
        top: calc((100hw - 852px)/2) !important;
    }

    .tagit-new input.ui-widget-content.ui-autocomplete-input {
        min-width: 130px !important;
    }
</style>
@LinkIt.BubbleSheetPortal.Web.Helpers.BundleHelper.StyleStudentPreferenceBundle() @LinkIt.BubbleSheetPortal.Web.Helpers.BundleHelper.ScriptStudentPreferenceBundle()
<script src="@Url.Content("~/Scripts/TagIt/js/tag-it.js")" type="text/javascript"></script>
<link href="@Url.Content("~/Scripts/TagIt/css/jquery.tagit.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Scripts/TagIt/css/tagit.ui-zendesk.css")" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="https://cdn.materialdesignicons.com/5.0.45/css/materialdesignicons.min.css">
<link href="/Content/libs/select2/comboTreePlugin.css" rel="stylesheet" />
<script src="/Content/libs/select2/comboTreePlugin.js"></script>
<div id="student-references">
    <div class="block-border form">
        <div class="filter-group  block-content">
            <h1>Student/Parent Portal Options</h1>
            <div class="tabs">
                <ul>
                    <li v-show="showDefaultOption" :class="tabActive === 1 ? 'is-active tab-view' : 'tab-view border-right' ">
                        <a v-on:click="onSelectTab(1)">Default Options</a>
                    </li>
                    <li v-show="showTestTypeOption" :class="tabActive === 2 ? 'is-active tab-view' : 'tab-view border-right'">
                        <a v-on:click="onSelectTab(2)">Category Options</a>
                    </li>
                    <li v-if="showSpecificOption" :class="tabActive === 3 ? 'is-active tab-view' : 'tab-view'">
                        <a v-on:click="onSelectTab(3)">Test-Specific Options</a>
                    </li>
                </ul>
            </div>
            <div v-show="tabActive === 1 || tabActive === 2" class="tabs-details" >
                <default v-on:changes-school='changeOptionView' ref='showTestTypeOption' />
            </div>
            <div v-show="tabActive === 3" class="tabs-details">
                <fieldset class="background-filter">
                    <legend>Select Options Level </legend>
                    <div style="float:none" class="fileter-item">
                        <label>Level</label>
                        <select v-model="selectedLevel" v-on:change='selectLevel' class="full-width" id="selectedLevel">
                            <option v-for="item in level" :value="item.value">{{item.text}}</option>
                        </select>
                    </div>
                    <div v-if="showSelectState" class="fileter-item">
                        <label>State</label>
                        <select v-model="selectedState" v-on:change="selectStates" class="full-width">
                            <option v-for="item in state" :value="item.Id">{{item.Name}}</option>
                        </select>
                    </div>
                    <div v-if="showSelectDistrict" class="fileter-item">
                        <label>{{districtLabel}}</label>
                        <select id="selectedDistrictID" v-model="selectedDistrict" v-on:change="onDistrictChange" class="full-width">
                            <option v-for="item in districts" :value="item.Id">{{item.Name}}</option>
                        </select>
                    </div>
                    <div v-if="showSelectSchool "
                         class="fileter-item">
                        <label>School</label>
                        <select id="selectedSchoolID" v-on:change="selectSchool" v-model="selectedSchool" class="full-width">
                            <option v-for="item in school" :value="item.Id">{{item.Name}}</option>
                        </select>
                    </div>
                    <div v-show="showSelectClasses"
                         class="fileter-item">
                        <label>Class</label>
                        <ul id="selectClasses" name="selectClasses" class="selectClasses tagit ui-widget ui-widget-content ui-corner-all full-width">
                        </ul>
                    </div>
                </fieldset>
                <fieldset class="background-filter checkbox-container">
                    <legend>Select Test Filters</legend>
                    <div class="fileter-checkbox filter-test-types">
                        <div v-show="showLoadingTest" class="bg-full">
                            <div class="loading-dot">Loading</div>
                        </div>
                        <input id="test-types" v-model="checkTestTypes" v-on:change="allSelectTestTypes" type="checkbox" name="test-types" class="chechbox" />
                        <label for="test-types">All Categories</label>
                        <div class="block-checkbox">
                            <div v-for="item in testType" class="checkbox-child">
                                <input :id="'test-type' + item.Id" v-on:change="selectCheckBoxTestTypes" type="checkbox" :value="item.Id" v-model="arrTestTypes" :name="item.Id"
                                       class="chechbox" :disabled="item.IsShow === false">
                                <label :title="item.Tooltip" :for="'test-type' + item.Id">{{item.Name}}</label>
                            </div>
                        </div>
                    </div>
                    <div class="fileter-checkbox">
                        <div v-show="showLoadingGrades" class="bg-full">
                            <div class="loading-dot">Loading</div>
                        </div>
                        <input id="grades" v-model="checkGrades" v-on:change="allSelectGrades" type="checkbox" name="grades" class="chechbox" />
                        <label for="grades">All @LocalizeHelper.LocalizedWithoutComment(LocalizeResourceKeys.GRADES_LABEL)</label>
                        <div class="block-checkbox">
                            <div v-for="item in grades" class="checkbox-child">
                                <input :id="item.Id" v-on:change="selectCheckBoxGrades" type="checkbox" :value="item.Id" v-model="arrGrades" :name="item.Id"
                                       class="chechbox">
                                <label :for="item.Id">{{item.Name}}</label>
                            </div>
                        </div>
                    </div>
                    <div class="fileter-checkbox checkbox-subject">
                        <div v-show="showLoadingSubjects" class="bg-full">
                            <div class="loading-dot">Loading</div>
                        </div>
                        <input id="subjects" type="checkbox" name="subjects" v-model="checkSubject" v-on:change="allSelectSubjects" class="chechbox" />
                        <label for="subjects">All @LabelHelper.Subjects</label>
                        <div class="block-checkbox">
                            <div v-for="item in subjects" class="checkbox-child">
                                <input :id="item.Name" :value="item.Name" v-model="arrSubject" v-on:change="selectCheckBoxSubjects" type="checkbox" :name="item.Name"
                                       class="chechbox">
                                <label :for="item.Name">{{item.Name}}</label>
                            </div>
                        </div>
                    </div>
                </fieldset>
                <button v-on:click="onFilter" id="btnFilter" :disabled='disabled ? true : false' class="btn-filter" type="submit">Apply Filters</button>
                <button v-on:click="onClearFilter" class="grey btn-clear-filter" type="submit">Clear Filters</button>
            </div>
        </div>
    </div>
    <div v-show="tabActive === 3" id="studentPreferencePage">
        <div id="listVirtualTest">
            <article class="container_12" style="margin-top:2em">
                <section class="grid-full-with">
                    <div class="block-border">
                        <div class="block-content form">
                            <h1>
                                Tests
                            </h1>
                            <p class="p-line">
                                <a href="#" id="changeRefBtn" class="btn-under-grid">
                                    CHANGE OPTIONS
                                </a>
                                <a href="#" id="changeOptionTest" class="btn-under-grid">
                                    Show Tests Shared at This Level: off
                                </a>
                            </p>
                            <p class="text-align: justify;"><b>Caution:</b> Be careful when changing options for multiple tests with different options in effect. The new options will be applied to all the selected tests regardless of their previous settings (unless an option is locked). If you change locking at higher levels, you may have to come back and reset test-specific options.</p>
                            <p style="height: 5px"></p>
                            <table id="dataTable" width="100%" cellspacing="0" class="datatable table no-margin">
                                <thead>
                                    <tr>
                                        <th scope="col" style="width: 35px;text-align: center">
                                            Select
                                            <input type="checkbox" class="check-box-all" />
                                        </th>
                                        <th scope="col">
                                            <span class="column-sort">
                                                <a href="javascript:void(0)" title="Sort Up" class="sort-up"></a>
                                                <a href="javascript:void(0)" title="Sort Down" class="sort-down"></a>
                                            </span>
                                            Test Name
                                        </th>

                                        <th scope="col">
                                            <span class="column-sort">
                                                <a href="javascript:void(0)" title="Sort Up" class="sort-up"></a>
                                                <a href="javascript:void(0)" title="Sort Down" class="sort-down"></a>
                                            </span>
                                            Category
                                        </th>
                                        <th scope="col">
                                            <span class="column-sort">
                                                <a href="javascript:void(0)" title="Sort Up" class="sort-up"></a>
                                                <a href="javascript:void(0)" title="Sort Down" class="sort-down"></a>
                                            </span>
                                            Subject
                                        </th>
                                        <th scope="col">
                                            <span class="column-sort">
                                                <a href="javascript:void(0)" title="Sort Up" class="sort-up"></a>
                                                <a href="javascript:void(0)" title="Sort Down" class="sort-down"></a>
                                            </span>
                                            @LocalizeHelper.LocalizedWithoutComment(LocalizeResourceKeys.GRADE_LABEL)
                                        </th>
                                        <th scope="col">
                                            <span class="column-sort">
                                                <a href="javascript:void(0)" title="Sort Up" class="sort-up"></a>
                                                <a href="javascript:void(0)" title="Sort Down" class="sort-down"></a>
                                            </span>
                                            Result Count
                                        </th>
                                        <th scope="col">
                                            <span class="column-sort">
                                                <a href="javascript:void(0)" title="Sort Up" class="sort-up"></a>
                                                <a href="javascript:void(0)" title="Sort Down" class="sort-down"></a>
                                            </span>
                                            Modified Date
                                        </th>
                                        <th scope="col">
                                            <span class="column-sort">
                                                <a href="javascript:void(0)" title="Sort Up" class="sort-up"></a>
                                                <a href="javascript:void(0)" title="Sort Down" class="sort-down"></a>
                                            </span>
                                            Modified By
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="height: 60px;"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </article>
        </div>
    </div>
    <div class="option-view" v-show='tabActive == 1 || tabActive == 2'>
        <option-default ref='showViewOption' />
    </div>
    <my-modal v-bind:show="showModal" v-bind:group-details="groupDetails" ref="modal" v-on:show-modal-student="toggleModal(false)" v-bind:spectific="spectific"></my-modal>
    <view-modal v-bind:showview="showview" v-bind:showloading="showloadingview" v-bind:rawhtml='rawhtml' ref="viewModal" v-on:show-modal-view='toggleModalView(false)'></view-modal>
</div>
<script type="text/javascript">
    var virtualTestID = '';
    var rolesValue = '@Model';
    var isSetDelay = false;
    var districtLabel = '@LocalizeHelper.LocalizedWithoutComment(LocalizeResourceKeys.DISTRICT_LABEL)';
</script>
<script type="text/javascript" src="/Scripts/Lib/vue.min.2.5.js"></script>
<script type="text/javascript" src="@Url.Content("~/Scripts/StudentPreference/callAjax.js")"></script>
<script type="text/javascript" src="/Scripts/StudentPreference/studentDefault.js"></script>
<script type="text/javascript" src="/Scripts/StudentPreference/optionDefaults.js"></script>
<script type="text/javascript" src="/Scripts/StudentPreference/studentPreference.js"></script>
<script type="text/javascript">
    $(function () {
        var textSearch = "";
        var urlSchoolName = replace ? replace : '';
        var showTest = false;
        var options = {
            bServerSide: true,
            bRetrieve: true,
            bDestroy: true,
            sAjaxSource: '@Url.Action("GetStudentTestPreferences")',
            bInfo: true,
            oSearch: {
                sSearch: textSearch
            },
            fnServerParams: function (aoData) {
                aoData.push(
                    { name: "DistrictID", value: app.selectedDistrict },
                    { name: "SchoolID", value: app.selectedSchool },
                    { name: "Level", value: app.selectedLevel },
                    { name: "VirtualTestTypeIds", value: app.addFilteredTestTypes.toString() },
                    { name: "GradeIDs", value: app.addFilteredGrades.toString() },
                    { name: "SubjectIDs", value: app.arrSubject.toString() },
                    { name: 'Visibilities', value: showTest ? '1' : '0' },
                    { name: 'ClassIds', value: app.selectedClassIds() },
                    { name: 'ExcludeTestTypes', value: app.addExcludeTestTypes.toString() },
                );
            },
            bAutoWidth: true,
            iDisplayLength: 50,
            aaSorting: [[1, "asc"]],
            aLengthMenu: [50, 100, 500],
            aoColumns: [
                { mData: 'VirtualTestID', sName: 'VirtualTestID', bSearchable: false, bSortable: false, sWidth: '50px', sClass: 'css-align-center' },
                { mData: 'TestName', sName: 'TestName', bSearchable: true, bSortable: true },
                { mData: 'DataSetCategory', sName: 'DataSetCategory', bSearchable: false, bSortable: true, sWidth: '100px' },
                { mData: 'Subject', sName: 'Subject', bSearchable: true, bSortable: true, sWidth: '100px' },
                { mData: 'Grade', sName: 'Grade', bSearchable: true, bSortable: true, sWidth: '80px' },
                { mData: 'ResultCount', sName: 'ResultCount', bSearchable: true, bSortable: true, sWidth: '100px', sClass: 'css-align-right' },
                { mData: 'ModifiedDate', sName: 'ModifiedDate', bSearchable: false, bSortable: true, sWidth: '100px', sClass: 'css-align-center' },
                { mData: 'ModifiedBy', sName: 'ModifiedBy', bSearchable: false, bSortable: true, sWidth: '100px', sClass: 'css-align-center' },

            ],
            fnRowCallback: function (nRow, aData) {
                $('td:eq(0)', nRow).parent().addClass('tableRow');

                $('td:eq(0)', nRow).html(setIconVisibility(aData.VirtualTestID));
                var dateStr = displayDateWithFormatJsonDate(aData.ModifiedDate);
                if (dateStr == "")
                    dateStr = "";
                $('td:eq(6)', nRow).html(dateStr);
                return nRow;
            },
            fnPreDrawCallback: function () {
                ShowBlock($('#dataTable'), "Loading");
                return true;
            },
            fnDrawCallback: function () {
                $('#dataTable').unblock();
                $('.with-tip').tip();
                if (!isSetDelay) {
                    searchDelay($("#dataTable_filter input[type='text']"), $("#dataTable"));
                    isSetDelay = true;
                }
            }
        };

        $("#dataTable").data("options", options);

        initializeDataTable($("#dataTable"));

        function setIconVisibility(virtualTestId) {
            var iconString = '';

            var preferenceIcon = '<p class="open-icon"><span><span>o</span></span></p>';
            var preferenceString = '';
            iconString = '<input type="checkbox" class="cbTestId" value="' + virtualTestId + '" />';
            preferenceString = '<a href="javascript:void(0)" title="Options" operation="0" virtualTestID="' + virtualTestId + '" class="with-tip jsViewPreference btn-review-assignment">' + preferenceIcon + '</a>';

            var openMatrix = '<a href="javascript:void(0)" title="Options in Effect" class="open-icon pointer btn-view-matrix with-tip jsViewPreference" virtualTestID="' + virtualTestId + '" ><span><span>E</span></span></a>';

            iconString += preferenceString + openMatrix;
            return iconString;
        }

        function searchDelay(inputFilter, dataTable) {
            var delay = null;

            inputFilter.off('keyup.DT input.DT');

            inputFilter.on("keyup", function () {
                var search = inputFilter.val();
                clearTimeout(delay);
                delay = setTimeout(function () {
                    if (search != null) {
                        dataTable.dataTable().fnFilter(search);
                    }
                }, 1000);
            });
        }
        $(document).on('click', '.jsViewPreference.btn-review-assignment', function (e) {
            e.preventDefault();
            var testId = $(this).attr('virtualtestid');
            virtualTestID = testId;
            showPreferenceModal(testId);
        });

        $('#dataTableListRef').on('click', '.btnPreferencesTest', function (event) {
            testID = $(this).attr('virtualtestid');
            showPreferenceModal(testID);
        });

        $(document).on('click', '#btnTestSettingCancel', function () {
            $('#divTestSettingTestPropertyPanel').dialog('close');
        });

        $(document).on('change', '.check-box-all', function () {
            if ($(this).attr('checked')) {
                $('#dataTable_wrapper tbody .cbTestId').attr('checked', true);
                var arrChecked = $('#dataTable_wrapper tbody .cbTestId:checked');
                if (arrChecked.length === 0) {
                    $('#changeRefBtn').addClass('btn-disabled');
                } else {
                    $('#changeRefBtn').removeClass('btn-disabled');
                }
            } else {
                $('#dataTable_wrapper tbody .cbTestId').attr('checked', false);
            }
        });
        $('#changeRefBtn').addClass('btn-disabled');
        $(document).on('change', '#dataTable_wrapper tbody .cbTestId', function () {
            $('.check-box-all').attr('checked', false);
            var arrChecked = $('#dataTable_wrapper tbody .cbTestId:checked');
            if (arrChecked.length === 0) {
                $('#changeRefBtn').addClass('btn-disabled');
            } else {
                $('#changeRefBtn').removeClass('btn-disabled');
            }
        });

        $('#changeOptionTest').on('click', function(e){
            e.preventDefault();
            if(!showTest) {
                $(this).text('Show Tests Shared at This Level: on');
                showTest = true ;
            }else{
                $(this).text('Show Tests Shared at This Level: off');
                showTest = false ;
            }
            loadData();
        });
        $(document).on('click', '.btn-view-matrix', function () {
            var testID = $(this).attr('virtualtestid');
            app.getViewOption(testID);
        });
        $('#changeRefBtn').on('click', function (e) {
            e.preventDefault();
            var testEls = $('.cbTestId:checked');
            var testIds = [];
            virtualTestID = '';
            for (var i = 0; i < testEls.length; i++) {
                testIds.push($(testEls[i]).val());
            }
            if (testIds.length > 0) {
                 if (testEls.length === 1) {
                    showPreferenceModal(testIds.join());
                } else {
                    showPreferenceModal(testIds.join());
                }
            }
        });

        function showPreferenceModal(testID, name) {
            ShowBlock($('#dataTable_wrapper'), 'Loading');
            $('#changeRefBtn').addClass('btn-disabled');
            app.getPreferences(testID);
        }
    });
    function loadData() {
        $('#changeRefBtn').addClass('btn-disabled');
        $("#dataTable").dataTable().fnDraw();
    }
     var comboTree1 = null;
     var categoryElementId = '#dataSetCategoryId';
    if (rolesValue != '5' && rolesValue != '27') {
        GetDataSetCategories();
    }

     function GetDataSetCategories(districtId = 0) {
         $.get('@Url.Action("GetDataSetCategoriesForStudentPreference", "CategoriesAPI")' + '?districtId=' + districtId, function (categories) {
             if (!comboTree1) {
                 comboTree1 = $(categoryElementId).comboTree({
                     source: [],
                     isMultiple: false,
                     cascadeSelect: true,
                     collapse: false,
                     selected: []
                 });
                 comboTree1.onChange(function () {
                     studentDefaultClass.tryGetOptionDefault();
                 });
             }
             comboTree1.setSource(categories);
            $(categoryElementId).change(function(e) {
                $(this).val(comboTree1 ? comboTree1.getSelectedNames() : '');
            });
        });
    }
</script>
